<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edinburgh Fringe 2024: Sold Out Shows</title>
    <meta name="description" content="All the sold out shows and shows which are about to sell out at Edinburgh Fringe 2024">
    <link rel="stylesheet" href="styles.css">
    <link rel="canonical" href="https://fringe-sold-out.humfreybrandes.com/">
    <script src="script.js" defer></script>
    <meta name="google-site-verification" content="XOC58bzYvsGFXG5uzXp5TKLJh1r2gATGdduojvePp5o" />
    <script src="https://cdn.amplitude.com/libs/analytics-browser-2.7.4-min.js.gz"></script>
    <script src="https://cdn.amplitude.com/libs/plugin-session-replay-browser-1.4.1-min.js.gz"></script>
    <script src="https://cdn.amplitude.com/libs/plugin-autocapture-browser-0.9.0-min.js.gz"></script>
    <script>
        window.amplitude.add(window.sessionReplay.plugin({ sampleRate: 1 })).promise.then(function () {
            window.amplitude.add(window.amplitudeAutocapturePlugin.plugin());
            window.amplitude.init('9ae900961d6628251825f5724250b654');
        });
    </script>

    <!-- Twitter Card meta tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Sold Out Shows at Edinburgh Fringe 2024">
    <meta name="twitter:description" content="All the sold out shows and shows which are about to sell out at Edinburgh Fringe 2024">
    <meta name="twitter:image" content="https://fringe-sold-out.humfreybrandes.com/twitter-card.png">
    <meta name="twitter:site" content="@SoldOutBoard">
    <meta name="twitter:creator" content="@SoldOutBoard">
</head>

<body>
    <div class="container sold-out-shows">
        <header>
            <h2 class="subtitle">Edinburgh Fringe 2024</h2>
            <h1 class="sold-out">SOLD OUT</h1>
        </header>
        <main>
            <ul class="show-list" id="sold-out-list">
                <!-- Sold-out shows will be dynamically inserted here -->
            </ul>
        </main>
        <footer>
            <p>Last updated: <span id="last-updated">Loading...</span><br><span style="font-size: 0.8em;"><a href="mailto:humfrey@brandes.co.uk">Email</a> - <a href="https://twitter.com/SoldOutBoard">Twitter</a></span></p>
        </footer>
    </div>

    <div class="container selling-out-shows">
        <header>
            <h2 class="subtitle">Selling out</h2>
        </header>
        <main>
            <ul class="show-list" id="selling-out-list">
                <!-- Selling-out shows will be dynamically inserted here -->
            </ul>
        </main>
    </div>

    <script>
       document.addEventListener('DOMContentLoaded', () => {
    const colors = ['yellow', 'pink', 'red', 'green', 'magenta', 'orange', 'cyan', 'blue'];

    // Function to format date
    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
    }

    // Function to get color class based on sold_out_dates_count
    function getColorClass(count) {
        if (count >= 10) return 'selling-out-red';
        if (count >= 5) return 'selling-out-pink';
        if (count >= 3) return 'selling-out-light-pink';
        return 'selling-out-white';
    }

    // Update show lists and last updated date
    async function updateContent() {
        try {
            const soldOutUrl = 'https://fringe-api.humfreybrandes.com/sold-out';
            const sellingOutUrl = 'https://fringe-api.humfreybrandes.com/selling-out';
            const lastUpdatedUrl = 'https://fringe-api.humfreybrandes.com/last-updated';

            const [soldOutResponse, sellingOutResponse, lastUpdatedResponse] = await Promise.all([
                fetch(soldOutUrl).then(res => res.json()),
                fetch(sellingOutUrl).then(res => res.json()),
                fetch(lastUpdatedUrl).then(res => res.json())
            ]);

            // Update Sold Out Shows
            const soldOutList = document.querySelector('#sold-out-list');
            soldOutList.innerHTML = soldOutResponse.map((show, index) => {
                const color = colors[index % colors.length];
                return `<li class='show-item' style='color: ${color};'>${show.title}</li>`;
            }).join('');

            // Update Selling Out Shows
            const sellingOutList = document.querySelector('#selling-out-list');
            sellingOutList.innerHTML = sellingOutResponse.map(show => `
                <li class='show-item ${getColorClass(show.sold_out_dates_count)}'>
                    <a href='https://tickets.edfringe.com/whats-on/${show.show_slug}'>${show.title}</a>
                </li>
            `).join('');

            // Update Last Updated Date
            const lastUpdatedDate = document.querySelector('#last-updated');
            lastUpdatedDate.textContent = formatDate(lastUpdatedResponse.updated);

            // Set links to open in a new tab
            const links = document.querySelectorAll('a');
            links.forEach(link => {
                link.setAttribute('target', '_blank');
            });

        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    updateContent();
});



    </script>
</body>

</html>
